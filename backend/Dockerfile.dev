# 后端开发环境 Dockerfile
FROM node:20-alpine

WORKDIR /app

# 安装 yarn
RUN corepack enable && corepack prepare yarn@stable --activate

# 复制 package 文件
COPY package.json ./

# 复制 yarn.lock（如果存在）
COPY yarn.lock* ./

# 安装所有依赖（包括 devDependencies）
# 如果有 yarn.lock 则使用 --frozen-lockfile
RUN if [ -f yarn.lock ]; then yarn install --frozen-lockfile; else yarn install; fi

# 复制源代码
COPY . .

# 暴露端口
EXPOSE 3001

# 启动开发服务器（热重载）
CMD ["yarn", "dev"]

